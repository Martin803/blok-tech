var ex = require('./lib/index.js');
var logger = require('./lib/logger.js');

function filterA() {
    return function (request, response, next) {
        logger.debug('filterA');
//        response.end('filterA');
        next(new Error('filterA'));
    };
}
function filterB() {
    return function (request, response, next) {
        logger.debug('filterB');
        next();
    }
}

var app = ex();
app.use(filterA());
app.use(filterB());
//app.error(function (request, response, error) {
//    logger.error('onerror', error);
//});

//logger.log(process._tickCallback.toString());
//logger.log(process.nextTick.toString());

require('http').createServer(app).listen(3001, function () {
    console.log('Listener port 3001');
});

require('child_process').exec('curl http://127.0.0.1:3001', function (error, stdout, stderr) {
    console.log(stdout);
});